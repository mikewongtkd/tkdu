<html>
    <head>
        <meta content="text/html; charset=utf-8" http-equiv="content-type">

        <title>Taekwondo University Quiz</title>
        <link href="include/jquery/add-ons/slickquiz/css/reset.css" media="screen" rel="stylesheet" type="text/css">
        <link href="include/jquery/add-ons/slickquiz/css/slickQuiz.css" media="screen" rel="stylesheet" type="text/css">
        <link href="include/jquery/add-ons/slickquiz/css/master.css" media="screen" rel="stylesheet" type="text/css">
    </head>

    <body id="slickQuiz">
        <h1 class="quizName"><!-- where the quiz name goes --></h1>

        <div class="quizArea">
            <div class="quizHeader">
                <!-- where the quiz main copy goes -->

                <a class="button startQuiz" href="#">Get Started!</a>
            </div>

            <!-- where the quiz gets built -->
        </div>

        <div class="quizResults">
            <h3 class="quizScore">You Scored: <span><!-- where the quiz score goes --></span></h3>

            <h3 class="quizLevel"><strong>Ranking:</strong> <span><!-- where the quiz ranking level goes --></span></h3>

            <div class="quizResultsCopy">
                <!-- where the quiz result copy goes -->
            </div>
        </div>

        <script src="./include/jquery/js/jquery.min.js"></script>
        <script src="./include/jquery/add-ons/purl/purl.js"></script>
        <script src="./include/jquery/add-ons/slickquiz/js/slickQuiz.js"></script>
        <script>
			$( function() {
				var url  = "http://localhost/tkduniversity/request";
				var quiz = {
					init: function( questions ) {
						$( '#slickQuiz' ).slickQuiz({
							json: questions,
							numberOfQuestions: 25,
							randomSortQuestions: true,
							randomSortAnswers: true,
							events: { onCompleteQuiz: function( options ) { quiz.stop( options ); }}
						});
					},
					start: function() {
						var subject = $.url().param( 'subject' );
						var request = { data: { action: 'read', subject: subject }}; request.json = JSON.stringify( request.data );
						$.post( url, request.json )
							.done( function( data ) {
								var questions = JSON.parse( data );
								if( questions.error ) {
									$( '.quizHeader' ).html( '<h1>Quiz for Subject ' + subject.toUpperCase() + ' Not Found</h1>' );
									console.log( questions );
								} else {
									quiz.init( questions );
								}
							})
							.fail(( error ) => {
								$( '.quizHeader' ).html( '<h1>Network Error</h1>' );
								console.log( error );
							});
					},
					stop: function( options ) {
						var k = parseFloat( options.score );
						var n = parseFloat( options.questionCount );
						if( k/n > 0.8 ) { return; }

						// Request user name
						var name   = $( '<input type="text" placeholder="Your Name">' );
						var button = $( '<button type="button">Get Certificate</button>' );
						$( '.quizResults' ).append( name, button );
						button.click( function( ev ) {
							var subject = $.url().param( 'subject' );
							var request = { data: { action: 'write', name: name.val(), subject: subject }}; request.json = JSON.stringify( request.data );
							$.post( url, request.json )
								.done( function( data ) {
									var response;
									// var response = JSON.parse( data );
									if( response.error ) {
										$( '.quizHeader' ).html( '<h1>Quiz for Subject ' + subject.toUpperCase() + ' Not Found</h1>' );
										console.log( response );
									} else {
										$( '.quizResults' ).append( response.certificate );
									}
								})
								.fail(( error ) => {
									$( '.quizHeader' ).html( '<h1>Network Error</h1>' );
									console.log( error );
								});
						});
					}
				};

				quiz.start();
			});
		</script>
    </body>
</html>

